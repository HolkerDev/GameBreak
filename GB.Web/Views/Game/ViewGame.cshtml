@model GB.Web.ViewModels.ViewGameVM
@{
    ViewBag.Title = "ViewGame";
}

<h2>ViewGame</h2>


<table class="table table-striped table-hover table-responsive">
    <thead>
        <tr>
            <th></th>
            <th>Name</th>
            <th>Release Date</th>
            <th>Production</th>
            <th>Game Platform</th>
            <th>Age Rating</th>
            <th>Genres</th>
            <th>Price</th>
            <th>Description</th>
        </tr>

        <tr>
            <td>
                @if (Model.Game.Image != null)
                {<img src="data:image;base64,@System.Convert.ToBase64String(Model.Game.Image)" width="80" height="80" />}
            </td>
            <td>@Model.Game.Name</td>
            <td>@Model.Game.ReleaseDate.ToShortDateString()</td>
            <td>@Model.Game.Production.Name</td>
            <td>@Model.Game.GamePlatform.Name</td>
            <td>@Model.Game.AgeRating.Name</td>
            <td>
                @foreach (var gameGenre in Model.Game.GameGenres)
                {
                    <span>@gameGenre.GenreName</span>
                }
            </td>
            <td>@Model.Game.Price</td>
            <td>@Model.Game.Description</td>
        </tr>

    </thead>
</table>
@if (HttpContext.Current.User.IsInRole("Administrator"))
{
    <button type="button" class="btn btn-primary" id="btn_delete" data-slno="@Model.Game.ID" onclick="location.href='@Url.Action("Edit","Game", new { gameID =  Model.Game.ID})'">
        Edit Game
    </button>
}

<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#locationModal">
    Add To Cart
</button>


<!-- Modal -->
<div class="modal fade" id="locationModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Game "@Model.Game.Name" to cart</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                @using (var form = Html.BeginForm("Add", "Cart", FormMethod.Post))
                {
                    @Html.HiddenFor(g => g.Game.ID)
                    @Html.HiddenFor(g =>g.Game.Name)
                    @Html.HiddenFor(g => g.Game.Price)
                    for (int i = 0; i < Model.Game.LocationsWithGameCopiesAvailable.Count(); i++)
                    {
                         @Html.HiddenFor(g => g.Game.LocationsWithGameCopiesAvailable[i].ID)
                         @Html.HiddenFor(g => g.Game.LocationsWithGameCopiesAvailable[i].Name)
                    }


                    <div class="form-group col-md-12">
                        @Html.DropDownListFor(x => x.Game.LocationChosenID, Model.LocationsSelect, new { @id = "locationSelect", @class = "form-control" })
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit">
                            <span class="glyphicon glyphicon-shopping-cart "></span>Add To Cart
                        </button>
                    </div>
                }
            </div>
            

            </div>
    </div>
    <script type="text/javascript" src="~/Scripts/jquery-3.3.1.min.js"></script>
    <script>

        @*var locationSelect = $("#locationSelect");

        $.ajax({
            type: "GET",
            url: "http://localhost:56946/api/location/GetAvailableLocationsForGame?gameID=" + @Model.Game.ID,
            success: function (data) {
                for (var i = 0; i < data.length; i++) {
                    var option = new Option(data[i].Name, data[i].ID, false, false);

                }
            }
        });*@

    </script>
