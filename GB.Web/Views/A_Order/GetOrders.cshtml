@model List<GB.Data.Dto.OrderDto>
@{
    ViewBag.Title = "GetAll";
}

<h2>GetAll</h2>
<h2>My Orders</h2>

<br />
<table class="table table-striped table-hover table-responsive">
    <thead>
        <tr>
            <th>ID</th>
            <th>User</th>
            <th>CreatedAt</th>
            <th>ExpiresAt</th>
            <th>Days left</th>
            <th>Penalty</th>
            <th>Total Price</th>
            <th>Total Price with Penalty</th>
            <th>Is Returned</th>
            <th>Game Copies</th>
            <th></th>

        </tr>
        @foreach (var order in Model)
        {
            <tr>
                <td>@order.ID</td>
                <td>@order.User.FullName</td>
                <td>@order.CreatedAt</td>
                <td>@order.ExpiresAt</td>
                <td>
                    @if (order.ExpiresAt >= DateTime.Now)
                    {
                        <span>@order.ExpiresAt.Subtract(order.CreatedAt).Days days</span>
                    }
                    else
                    {
                        <span>EXPIRED</span>
                    }
                </td>
                <td>
                    @if (order.ExpiresAt < DateTime.Now)
                    {
                        <span>@order.ExpiresAt.Subtract(order.CreatedAt).Days * 0.30</span>
                    }
                    else
                    {
                        <span></span>
                    }
                </td>
                <td>@order.TotalPrice</td>
                <td>
                    @if (order.ExpiresAt < DateTime.Now)
                    {
                        <span>@order.TotalPrice+@order.ExpiresAt.Subtract(order.CreatedAt).Days * 0.30</span>
                    }
                    else {
                        <span>@order.TotalPrice</span>
                    }
                            </td>
                <td>
                    @if (order.IsFinishedAt != null)
                    {
                        <span>Yes</span>
                    }
                    else
                    {
                        <span>No</span>
                    }
                </td>
                <td>
                    @foreach (var game in order.OrderGameCopies)
                    {
                        <span>@game.GameName, @game.LocationName</span><br />
                    }
                </td>
                <td>
                    <button id="btn_delete" class="label label-primary" data-slno="@order.ID" onclick="location.href='@Url.Action("FinishOrder","A_Order", new { orderID =  order.ID})'">
                        Finish Order
                    </button>
                </td>
            </tr>
        }
    </thead>
</table>

